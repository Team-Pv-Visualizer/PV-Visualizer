<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>PV-Visualizer</title>
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    <link rel="stylesheet" href="../css/fronius_dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.min.js"></script>
  </head>
  <body>
    <div class="header">
      <h1>
        <span class="solar-panel-icon">
          <img src="https://www.solarweb.com/Content/images/fronius-logo.svg" alt="Solar Panel Icon" /> Fronius Dashboard </span>
      </h1>
      <a href="../index.html" class="home-button"></a>
    </div>
    <h1>PV - Ãœbersicht:</h1>
    <div>
      <style>
        canvas {
          user-select: none;
          width: 100%;
        }
      </style>
      <div style="display:flex; width:100%;">
        <div style="flex:1; margin:10px;">
          <h2>Chart-Titel</h2>
          <canvas id="canvas1" style="height:500px;"></canvas>
        </div>
        <div style="flex:1; margin:10px;">
          <h2>Chart-Titel</h2>
          <canvas id="canvas2" style="height:500px;"></canvas>
        </div>
      </div>
    </div>
    </div>
    <script>
      const ctx = document.getElementById('canvas1');
      //Daten aus der Datenbank holen
      fetch('../php/graph1.php').then(response => response.json()).then(data => {
        //Daten in das Chart-Format konvertieren
        const chartData = {
          labels: data.map(datum => datum.Datum),
          datasets: [{
            label: 'Stromverbrauch',
            data: data.map(datum => datum.Stromverbrauch),
            backgroundColor: 'rgba(255, 99, 132, 0.2)',
            borderColor: 'rgba(255, 99, 132, 1)',
            borderWidth: 1
          }]
        };
        //Chart erstellen
        new Chart(ctx, {
          type: 'bar',
          data: chartData,
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              yAxes: [{
                ticks: {
                  beginAtZero: true
                }
              }]
            }
          }
        });
      });
      const chartElement = document.getElementById('canvas2');
      const ctx2 = chartElement.getContext('2d');
      let data = null;
      fetch('../php/graph2.php').then(response => response.json()).then(jsonData => {
        data = jsonData;
        const config = {
          type: 'line',
          data: {
            labels: data.map(item => item.time),
            datasets: [{
              label: 'Last 24 hours',
              data: data.map(item => item.value),
              fill: false,
              borderColor: 'rgb(75, 192, 192)',
              tension: 0.1
            }]
          },
          options: {
            scales: {
              x: {
                type: 'time',
                time: {
                  format: 'YYYY-MM-DD HH:mm:ss',
                  tooltipFormat: 'll HH:mm'
                }
              }
            }
          }
        };
        new Chart(ctx2, config);
      }).catch(error => {
        console.error('Error:', error);
      });
    </script>
  </body>
</html>